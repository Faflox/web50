{% extends "network/layout.html" %}
{% load static %}


{% block title %}Profile Page{% endblock %}


{% block head %}
    <link rel="stylesheet" href="{% static 'network/profile.css' %}">
{% endblock %}


{% block body %}
    <div class="content">
        <div class="left-row">
            <div class="profile-image-container">
                {% if user.profilePicture %}
                    <img class="profile-image" src="{{ user.profilePicture }}" alt="Profile Picture">
                {% else %}
                    <img class="profile-image" src="images/default.jpg" alt="Profile Picture">
                {% endif %}
            </div>
            
            <button class="action-button change-profile-picture-button">Edit Profile Picture</button>
            <div class="change-profile-picture">
                <form method="POST" enctype="multipart/form-data">
                    {% csrf_token %}
                    <input class="action-button" type="file" name="profilePicture" accept="image/*">
                    <input class="action-button" type="submit" value="Submit">
                </form>
            </div>
            <b>{{ user.username }}</b>
            <br>
            {{ user.first_name }}
            {{ user.last_name }}
            <br>
            <br>
            <div class="followers-stats">
                <div>
                    <!-- <img src="styles/followers.svg" alt="Followers"> -->
                    Followers:
                </div>
                <div>
                    Following:
                </div>
            </div>
            <button class="action-button">Follow Button</button>
            <div class="description">
                {{ user.description }}
                <input type="submit" class="action-button change-description-button" value="Edit Description" onclick="openModal()">
            </div>
            <div id="description-modal" class="modal">
            </div>
            <br>
            Joined: {{ user.date_joined.date}}
        </div>

        <div class="right-row">

            {% if posts %}
                <div class="posts-container">
                    {% for post in posts %}
                        <div class="post">
                            <div class="first-row">
                                <b>From: {{ post.user.username }}</b>
                                <br>
                                <i>{{ post.date }}</i>
                            </div>
                            <br>
                            {{ post.content }}
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="loader">No posts from this user yet.</div>
            {% endif %}
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const currentUser = '{{ user }}';
            const editButton = document.querySelector('.change-profile-picture-button');
            const changeDescriptionButton = document.querySelector('.change-description-button');
            const changeProfilePicture = document.querySelector('.change-profile-picture');
            changeProfilePicture.style.display = 'none';

            load_posts(currentUser);

            if (currentUser !== '{{ user.username }}') {
                editButton.style.display = 'none';
                changeDescriptionButton.style.display = 'none';
            }
        
            editButton.addEventListener('click', function() {
                changeProfilePicture.style.display = changeProfilePicture.style.display === 'none' ? 'block' : 'none';
            });
        });

    </script>
{% endblock %}